# 日本地理 Attention クイズアプリケーション
(Japan Geography Attention Quiz App)

## 📖 1. プロジェクト概要

### 1.1 プロジェクト名
日本地理 Attention クイズアプリケーション開発

### 1.2 目的
論文「**Attention Is All You Need**」で提唱された**Attentionメカニズム（注意機構）**の数学的概念を、外部のAIライブラリ（OpenAI APIやPyTorch等）に依存せず、**Pythonの標準的な数値計算のみで再現**し、Webアプリケーションとして実装しました。

ユーザーの曖昧な検索意図（Query）と、データベース内の問題文（Key）の類似度を計算し、最も適切なクイズを提供する体験型学習アプリケーションです。

---

## 🛠 2. システム構成

### 2.1 開発環境・技術スタック
* **言語:** Python 3.x
* **フレームワーク:** Flask (Webバックエンド)
* **データベース:** SQLite3
* **フロントエンド:** HTML5, CSS3, JavaScript (Vanilla JS)
* **アルゴリズム:** 自作Simple Attention Engine (Bag-of-Characters + Scaled Dot-Product Attention)

### 2.2 アーキテクチャ (MVCモデル準拠)
* **Model:** SQLiteデータベースおよびAttention計算ロジック
* **View:** HTMLテンプレート (`index.html`)
* **Controller:** Flaskルーティング (`app.py`)

---

## 🚀 3. 機能要件

### 3.1 ユーザー機能（フロントエンド）

#### 🔍 検索機能
* ユーザーが任意のキーワード（例：「小さい県」「川」）を入力できるテキストボックスを提供。
* Enterキーまたは検索ボタン押下により、非同期通信（Fetch API）で検索リクエストを送信。

#### 📝 クイズ出題機能
* サーバーから返却された「最も関連度の高い問題」を表示。
* カテゴリ、問題文、選択肢（4択・ランダムシャッフル）を表示。
* **AI（システム）による判定メッセージ**（例：「Attentionスコア: 0.8521」）を表示し、検索意図との合致度を可視化。

#### ✅ 回答・判定機能
* ユーザーが選択肢をクリックした際、即座に正誤判定を行う。
* 正解の場合は緑色、不正解の場合は赤色でUIを強調表示。
* 問題の解説文を表示し、学習をサポート。

### 3.2 システム機能（バックエンド）

#### 💾 データ管理機能
* アプリケーション起動時にデータベースを初期化し、所定の10問の地理データを自動登録。
* データの重複を防ぐため、初期化時に既存テーブルの再作成（`DROP` & `CREATE`）を実行。

#### 🧠 Attention検索エンジン（検索ロジック）
1.  **Embedding（埋め込み）:** 全問題文に含まれる文字を語彙（Vocabulary）とし、入力テキストを0/1のベクトルに変換。
2.  **Scaled Dot-Product Attention:**
    * クエリ($Q$)と全問題文($K$)の内積（Dot Product）を計算。
    * ベクトルの次元数($d_k$)の平方根で除算し、スケーリングを行う。
    * Softmax関数を用いて、スコアを確率分布（合計1.0）に正規化。
3.  **フォールバック機能:**
    * 算出されたAttentionスコアの最大値が閾値（0.15）を下回る場合、「関連なし」と判断し、ランダムに問題を出題。

---

## 🗂 4. データベース設計

### 4.1 テーブル定義: `quizzes`

| カラム名 | データ型 | 制約 | 説明 |
| :--- | :--- | :--- | :--- |
| `id` | INTEGER | PRIMARY KEY, AUTOINCREMENT | 一意の管理ID |
| `category` | TEXT | NOT NULL | クイズのジャンル（例: 地理） |
| `question` | TEXT | NOT NULL | 問題文（Attention計算のKeyとして使用） |
| `options` | TEXT | NOT NULL | 選択肢リスト（JSON形式文字列として格納） |
| `correct_answer`| TEXT | NOT NULL | 正解の文字列 |
| `explanation` | TEXT | NOT NULL | 解説文 |

---

## 📐 5. アルゴリズム仕様詳細

本システムの中核となる検索ロジックは、以下の数式モデルに基づいて実装されています。

### 5.1 数式モデル
$$\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V$$

### 5.2 処理フロー

1.  **Vocabulary作成:**
    * データベース内の全問題文を結合し、重複のない文字セットを作成する。これの要素数を次元数 $d_k$ とする。

2.  **Vector化:**
    * ユーザー入力（Query） → ベクトル $Q$
    * 各問題文（Key） → ベクトル $K$
    * （文字が存在すれば1、しなければ0とする簡易Bag-of-Wordsモデル）

3.  **スコア計算:**
    * $Score = \sum (Q_i \times K_i)$ （内積）
    * $ScaledScore = Score / \sqrt{d_k}$

4.  **確率変換:**
    * Softmax関数により、スコアを確率（Weight）に変換する。

5.  **選定:**
    * Weightが最も高い問題をユーザーへの提示対象とする。

---

## 🌐 6. 非機能要件

* **ユーザビリティ:** レスポンシブデザインを採用し、PCおよびスマートフォンでの操作を可能にする。非同期通信（AJAX）を用い、ページ遷移なしでスムーズにクイズが出題されること。
* **可用性:** ローカル環境（localhost）での動作を保証する。例外処理を含み、不正な入力があってもサーバーが停止しないこと。
* **拡張性:** 将来的に問題データを追加・変更する際、`insert_sample_data` 関数の修正のみで対応可能な構造とする。

---

## 💻 実行方法 (How to Run)

1. リポジトリをクローンします。
2. 必要なライブラリをインストールします。
   ```bash
   pip install Flasktall flask
